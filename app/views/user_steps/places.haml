= render partial: "shared/steps"

.container.find_friends
  .row
    .spam12
      .data
        - unless @places.uniq.empty?
          .pushv3
            %table.table.table-condensed
              %thead
                %tr
                  %th Location
                  %th
              %tbody
                - @places.uniq.each do |location|
                  %tr
                    %td= location
                    %td
                      = link_to "javascript:;", class: "open-modal", :"data-toggle" => "modal", :"data-info" => "#{location}" do
                        %i.icon-plus
                        Add
        - else
          sasdas


.modal.hide.fade#mymodal{:role => "dialog", :"aria-labelledby" => "myModalLabel", :"aria-hidden" => "true"}
  .modal-header
    %input.close.close-modal{type: "button", :"data-dismiss" =>"modal", :"aria-hidden" => "true"}
      &times;
    %h3
      Add Travel in
      %span{id: "travel_location_title"}
  .modal-body
    =form_tag user_travels_path(current_user) do
      = text_field_tag :location,"", class: "text", placeholder: "Location"

      = text_field_tag :start_date,"", class: "text start_datepicker", placeholder: "Start date"

      = text_field_tag :end_date,"", class: "text end_datepicker", placeholder: "End end_date"

  .modal-footer
    = submit_tag "Close", class: "btn close-modal"
    = submit_tag "Add", class: "btn btn-primary"

:javascript
  $(".open-modal").click(function(){
    var location = $(this).attr("data-info");
    console.log(location);
    $("#travel_location_title").html(location);
    $("#location").val(location)
    $(".modal").modal("show");
  })

  $(".close-modal").click(function(){
    $(".modal").modal("hide")
  })


  $('.end_datepicker').datepicker({
    onSelect: function(dateText, inst){
      var start_date = $(".start_datepicker").val();
      var end_date = dateText;
      if(start_date != ""){
        var location = $("#location").val()
        $.ajax({
          url: "/get_checkins",
          data: { location: location, start_date: start_date, end_date: end_date },
          success: function(response){
            console.log(response)
          }
        });
      }
    }
  });

  $('.start_datepicker').datepicker({
    onSelect: function(dateText, inst){
      var start_date = dateText;
      var end_date = $(".end_datepicker").val();
      if(end_date != ""){
        var location = $("#location").val();
        $.ajax({
          url: "/get_checkins",
          data: { location: location, start_date: start_date, end_date: end_date },
          success: function(response){
            console.log(response)
          }
        });
      }
    }
  });






