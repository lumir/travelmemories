= link_to "Create New Travel","#", class: "open-modal", :"data-toggle" => "modal"

my Timeline

.modal.hide.fade#mymodal{:role => "dialog", :"aria-labelledby" => "myModalLabel", :"aria-hidden" => "true"}
  .modal-header
    %input.close.close-modal{type: "button", :"data-dismiss" =>"modal", :"aria-hidden" => "true"}
      &times;
    %h3
      Add Travel to
      %span{id: "travel_location_title"}
  .modal-body
    =form_tag user_travels_path(current_user), id: "submit_travel_form" do
      = hidden_field_tag :checkins_ids

      = text_field_tag :location,"", class: "text", placeholder: "Location", :autocomplete => "off"
      
      = text_field_tag :start_date,"", class: "text start_datepicker", placeholder: "Start date"
      
      = text_field_tag :end_date,"", class: "text end_datepicker", placeholder: "End date"
  
    #checkins_container

  .modal-footer
    =submit_tag "Close", class: "btn close-modal"
    =submit_tag "Add", class: "btn btn-primary", id:"submit_travel_info"


:javascript
  
  $("#location").keyup(function(){
    var location = $(this).val();
    $.ajax({
      url: "/get_checkins",
      data: { location: location, simple: "true"},
      success: function(response){            
        console.log(response)
        my_response = JSON.parse(response)
        $("#checkins_container").html("");
        $.each(my_response, function(index, value) { 
          var checkin_id = value.id
          var image_icon = value.venue.categories[0].icon
          var name = value.venue.name
          var description = value.shout              
                 
          $("#checkins_container").prepend("<input class='checkin_checkbox' type='checkbox' data-id='"+checkin_id+"'><img src="+image_icon+"><p>"+name+"</p> <p>"+description+"</p>");
        });
      }
    });
  })

  $("#submit_travel_info").click(function(){    
    var ids = "";
    var selected_checkins = $(".checkin_checkbox:checked");
    $.each(selected_checkins, function(index, value) { 
      ids += $(value).attr("data-id")+","
    });    
    $("#checkins_ids").attr("value", ids);
    $("#submit_travel_form").submit();  
  });
  
  $(".open-modal").click(function(){
    var location = $(this).attr("data-info");    
    $("#travel_location_title").html(location);
    $("#location").val(location)
    $(".modal").modal("show");
  })

  $(".close-modal").click(function(){
    $(".modal").modal("hide")
  })


  $('.end_datepicker').datepicker({
    onSelect: function(dateText, inst){
      var start_date = $(".start_datepicker").val();
      var end_date = dateText;
      if(start_date != ""){
        var location = $("#location").val()
        $.ajax({
          url: "/get_checkins",
          data: { location: location, start_date: start_date, end_date: end_date },
          success: function(response){            
            my_response = JSON.parse(response)
            $("#checkins_container").html("");
            $.each(my_response, function(index, value) { 
              var checkin_id = value.id
              var image_icon = value.venue.categories[0].icon
              var name = value.venue.name
              var description = value.shout              
                     
              $("#checkins_container").prepend("<input class='checkin_checkbox' type='checkbox' data-id='"+checkin_id+"'><img src="+image_icon+"><p>"+name+"</p> <p>"+description+"</p>");
            });          
          }
        });
      }
    }
  });

  $('.start_datepicker').datepicker({
    onSelect: function(dateText, inst){
      var start_date = dateText;
      var end_date = $(".end_datepicker").val();
      if(end_date != ""){
        var location = $("#location").val();
        $.ajax({
          url: "/get_checkins",
          data: { location: location, start_date: start_date, end_date: end_date },
          success: function(response){  
            my_response = JSON.parse(response)
            $("#checkins_container").html("");
            $.each(my_response, function(index, value) { 
              var checkin_id = value.id
              var image_icon = value.venue.categories[0].icon
              var name = value.venue.name
              var description = value.shout    
              console.log(value)          
              $("#checkins_container").prepend("<input class='checkin_checkbox' type='checkbox' data-id='"+checkin_id+"'><img src="+image_icon+"><p>"+name+"</p> <p>"+description+"</p>")
            });          
            
          }
        });
      }
    }
  });